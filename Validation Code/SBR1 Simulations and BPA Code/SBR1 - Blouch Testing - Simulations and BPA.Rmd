---
title: "SBR1 - Blouch Testing - BPA"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

Load functions used for testing
```{r}
#library(mvMORPH)
rm(list=ls())
library(rstan)
library(treeplyr)
library(slouch)
#For execution on a local, multicore CPU with excess RAM we recommend calling
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)

#devtools::install_github("kopperud/slouch")
#library(slouch)

library(mvSLOUCH)
#library(bayou)
library(PCMBaseCpp)
library(treeplyr)
library(TreeSim)
library(TreeSimGM)
library(ggsci)
library(ggplot2)
library(plotly)

dotR <- file.path(Sys.getenv("HOME"), ".R")
if (!file.exists(dotR)) dir.create(dotR)
M <- file.path(dotR, "Makevars")
if (!file.exists(M)) file.create(M)
arch <- ifelse(R.version$arch == "aarch64", "arm64", "x86_64")
cat(paste("\nCXX14FLAGS += -O3 -mtune=native -arch", arch, "-ftemplate-depth-256"),
    file = M, sep = "\n", append = FALSE)
```

Data Prep
```{r}
cervid.tree<-read.nexus("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/Original Submission/Data/Antler Dataset/cervidae_renamed.tre")

#cervid.tree<-read.nexus("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/Original Submission/Data/Antler Dataset/cervidae_renamed.tre")

#Updated dataset - 12/20/2022 - deleted number column and changed Taxa to Genus_Species
cervid.dataset<-read.csv("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Updated Dataset/updated_mean_dat_no_OL_MG.csv")

#cervid.dataset<-read.csv("")

#Remove Muntiacus_atherodes, Elaphodus_cephalophus - rudamentary and female Rangifer. 
cervid.dataset<-filter(cervid.dataset,Genus_Species != "Sinomegaloceros_yabei" & ! Genus_Species =="Alces_alces_gigas"  & ! Genus_Species == "Muntiacus_truongsonensis" & ! Genus_Species ==  "Mazama_temama"& ! Genus_Species ==  "Muntiacus_feae" & ! Genus_Species ==  "Muntiacus_atherodes" & ! Genus_Species ==  "Elaphodus_cephalophus")


cervid.trdata <- make.treedata(cervid.tree, cervid.dataset,name_column="Genus_Species")
cervid.trdata<-mutate(cervid.trdata,me.log_ant_vol=cervid.trdata$dat$log_vol_var_est/cervid.trdata$dat$n)
cervid.trdata<-mutate(cervid.trdata,me.log_psl=cervid.trdata$dat$log_psl_var_est/cervid.trdata$dat$n)

cervid.trdata<-mutate(cervid.trdata,mc.log_ant_vol=log_ant_vol-(mean(log_ant_vol)),mc.log_psl=log_psl-mean(log_psl))


names.traits<-c("mc.log_ant_vol","mc.log_psl",NA,NA)

#names.traits<-c("mc.log_ant_vol","mc.log_psl","me.log_ant_vol","me.log_psl")
cervid.trdata<-filter(cervid.trdata,!(is.na(log_ant_vol)) & !(is.na(log_psl)))
cervid.trdata<-filter(cervid.trdata,!(is.na(me.log_ant_vol)) & !(is.na(me.log_psl)))
cervid.trdata


```

Rescale Tree to Height =1
```{r}
l.tree<-max(branching.times(cervid.trdata$phy))
cervid.trdata$phy$edge.length<-cervid.trdata$phy$edge.length/l.tree ## rescale tree to height 1
max(branching.times(cervid.trdata$phy))

```


Number of iterations per half life
```{r}
N<-20

```

Adaptive Model
Half-life Accuracy Simulation Loops - varying tip nummber, hl, vy constant
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.adapt.bpa<-NULL
saved.adapt.parameters<-NULL

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
opt.slope<-0.25
hl.list<-c(0.01,0.05,0.1,0.25,0.5,0.75,1.0,2.0) #For Main Plots
#hl.list<-seq(from=0.001, to=1, by=0.05) #For BPA Plots
#hl.list<-0.1
#tips.list<-c(32,64,126)


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

vY0 <- 2
vX0 <- 4

##################################
#vy<-0.0001

#saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
##sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
#saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])


##################################
vy<-0.001


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])


#######################
vy<-0.01


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

#######################
vy<-0.1


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

```


```{r}
save.image(file = "SBR1 - Blouch - Main Sims - Blouch Adaptive - WS_122022.RData")
save.image(file = "SBR1 - Blouch - BPA Plots - Blouch Adaptive - WS_122022.RData")
```



Slouch Version
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
 
saved.slouch.adapt.bpa<-NULL
saved.slouch.adapt.parameters<-NULL
saved.slouch.trees<-list()
saved.slouch.data<-list()
##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-seq(from=0.001, to=1, by=0.05)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#tips.list<-c(32,64,128)
#tips.list<-c(32)
#hl.list<-c(0.01,0.1) #Test


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

##################################
#vy<-0.0001

#sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
#saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
#saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
#saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
#saved.slouch.data<-list(saved.slouch.data,sim[[4]])

##################################
vy<-0.001


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])


#######################
vy<-0.01


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

#######################
vy<-0.1


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

```


```{r}
save.image(file = "SBR1 - Blouch Testing - BPAs -Adaptive inc. Slouch- WS_122022.RData")
save.image(file = "SBR1 - Blouch Testing - BPAs - Slouch Adaptive - 122022.RData")

```


Make Plots using SBR1 - Blouch Testing - BPA Plots


Direct Effect Model
Half-life Accuracy Simulation Loops - varying tip nummber, hl, vy constant
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.direct.bpa<-NULL
saved.direct.parameters<-NULL
direct.slope <- 0.25
#hl.list<-seq(from=0.001, to=1, by=0.05) #For BPA Plots
hl.list<-c(0.01,0.05,0.1,0.25,0.5,0.75,1.0,2.0) #For Main Plots

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-c(0.05,0.1,0.25,0.5,1.0)
#hl.list<-c(0.05,0.1,0.25,0.3,0.4,0.5,0.75,1.0,2.0)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#hl.list[1]<-0.0001
#tips.list<-c(32,64,126)

#hl.list<-c(0.01,0.1) #Test


vY0 <- 2
vX0 <- 4

##################################
#vy<-0.0001

#sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
#saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
#saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])


##################################
vy<-0.001


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])


#######################
vy<-0.01


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])

#######################
vy<-0.1


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])

#saved.bpa<-saved.bpa[-1,] #Remove first row - really small (almost 0 half life)

```


```{r}
save.image(file = "SBR1 - Blouch - Main Sims - Blouch Direct - WS_122022.RData")
save.image(file = "SBR1 - Blouch - BPA Plots - Blouch Direct - WS_122022.RData")

```


Slouch Version
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")

saved.slouch.direct.bpa<-NULL
saved.slouch.direct.parameters<-NULL
saved.slouch.trees<-list()
saved.slouch.data<-list()
##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-seq(from=0.001, to=1, by=0.05)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#tips.list<-c(32,64,128)
#tips.list<-c(32)
#hl.list<-c(0.01,0.1) #Test


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

##################################
#vy<-0.0001

#sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
#saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
#saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
#saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
#saved.slouch.data<-list(saved.slouch.data,sim[[4]])

##################################
vy<-0.001


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])


#######################
vy<-0.01


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

#######################
vy<-0.1


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

```


```{r}
save.image(file = "SBR1 - Blouch Testing - BPAs - Souch Direct- WS_122022.RData")
save.image(file = "SBR1 - Blouch Testing - BPAs -Blouch Souch Direct More Runs- WS_122022.RData")

```


#######################

Brownian motion Loops

Brownian Slope Accuracy Simulation Loops
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.BM.bpa<-NULL
saved.BM.parameters<-NULL

##################################
brown.slope<-0.25
#sigma2y.list<-seq(from=0.05, to=1, by=0.05)
sigma2y.list<-c(0.05,0.1,0.25,0.3,0.4,0.5,0.75,1.0,2.0)

#tips.list<-c(32,64,126)

#Mean centered X
vX0 <- 2

##################################
sim<-stan.BM.inac.hl(tips.list=NULL,cervid.trdata$phy,N,brown.slope,vX0,sigma2y.list)
saved.BM.parameters<-rbind(saved.BM.parameters,sim[[1]])
saved.BM.bpa<-rbind(saved.BM.bpa,sim[[2]])

```

```{r}
save.image(file = "SBR1 - Blouch Testing - BPAs - WS_122022_pt2.RData")

```








#########################
Changing number of tips plots based on resampling 10K tree
```{r}
#tree<-read.tree("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/Original Submission/Blouch Testing/Phylogeny/10KPrimateTree.tre") #Read in primate tree to sample from it
tree<-read.tree("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/Original Submission/Blouch Testing/Phylogeny/10KPrimateTree.tre") #Read in primate tree to sample from it

l.tree<-max(branching.times(tree))
tree$edge.length<-tree$edge.length/l.tree ## rescale tree to height 1
max(branching.times(tree))


```

```{r}
N<-20
```


Adaptive model
```{r}
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")


saved.adapt.bpa<-NULL
saved.adapt.parameters<-NULL

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
opt.slope<-0.25
#hl.list<-seq(from=0.05, to=2, by=0.05)
hl.list<-c(0.001,0.1,1.0)
tips.list<-c(32,64,128)


#Mean centered X and Y
vY0 <- 2
vX0 <- 4


##################################
vy<-0.001

sim<-stan.adapt.OU.inac.hl(tips.list=tips.list,tree,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

sim<-stan.adapt.OU.inac.hl(tips.list=tips.list,tree,N,opt.slope,hl.list,vy,vY0,vX0,sym=1)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

saved.adapt.parameters$sym[saved.adapt.parameters$sym==0]<-saved.adapt.parameters$tips[saved.adapt.parameters$sym==0]
saved.adapt.parameters$sym[saved.adapt.parameters$sym==1]<-paste(saved.adapt.parameters$tips[saved.adapt.parameters$sym==1],"-sym",sep="")
saved.adapt.bpa$sym[saved.adapt.bpa$sym==0]<-saved.adapt.bpa$tips[saved.adapt.bpa$sym==0]
saved.adapt.bpa$sym[saved.adapt.bpa$sym==1]<-paste(saved.adapt.bpa$tips[saved.adapt.bpa$sym==1],"-sym",sep="")


```


```{r}
save.image(file = "SBR1 - Blouch Testing - Changing Tips Adaptive- WS_122022.RData")
```


Direct Effect Model
```{r}
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")


saved.direct.bpa<-NULL
saved.direct.parameters<-NULL

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
direct.slope<-0.25
#hl.list<-seq(from=0.05, to=2, by=0.05)
#hl.list<-c(0.1,0.25,1.0)
#tips.list<-c(32,64,128)


#Mean centered X and Y
vY0 <- 2
vX0 <- 4


##################################
vy<-0.1

sim<-stan.direct.OU.inac.hl(tips.list=tips.list,tree,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])

sim<-stan.direct.OU.inac.hl(tips.list=tips.list,tree,N,direct.slope,hl.list,vy,vY0,vX0,sym=1)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])


saved.direct.parameters$sym[saved.direct.parameters$sym==0]<-saved.direct.parameters$tips[saved.direct.parameters$sym==0]
saved.direct.parameters$sym[saved.direct.parameters$sym==1]<-paste(saved.direct.parameters$tips[saved.direct.parameters$sym==1],"-sym",sep="")
saved.direct.bpa$sym[saved.direct.bpa$sym==0]<-saved.direct.bpa$tips[saved.direct.bpa$sym==0]
saved.direct.bpa$sym[saved.direct.bpa$sym==1]<-paste(saved.direct.bpa$tips[saved.direct.bpa$sym==1],"-sym",sep="")


```

BM Model
```{r}
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")

saved.BM.bpa<-NULL
saved.BM.parameters<-NULL

##################################
brown.slope<-0.25
#sigma2y.list<-seq(from=0.05, to=1, by=0.05)
sigma2y.list<-c(0.1,0.25,1.0)
#sigma2y.list<-c(0.1)
tips.list<-c(32,64,128)

#Mean centered X
vX0 <- 0

##################################
sim<-stan.BM.inac.hl(tips.list=tips.list,tree,N,brown.slope,vX0,sigma2y.list,sym=0)
saved.BM.parameters<-rbind(saved.BM.parameters,sim[[1]])
saved.BM.bpa<-rbind(saved.BM.bpa,sim[[2]])

sim<-stan.BM.inac.hl(tips.list=tips.list,tree,N,brown.slope,vX0,sigma2y.list,sym=1)
saved.BM.parameters<-rbind(saved.BM.parameters,sim[[1]])
saved.BM.bpa<-rbind(saved.BM.bpa,sim[[2]])

saved.BM.parameters$sym[saved.BM.parameters$sym==0]<-saved.BM.parameters$tips[saved.BM.parameters$sym==0]
saved.BM.parameters$sym[saved.BM.parameters$sym==1]<-paste(saved.BM.parameters$tips[saved.BM.parameters$sym==1],"-sym",sep="")
saved.BM.bpa$sym[saved.BM.bpa$sym==0]<-saved.BM.bpa$tips[saved.BM.bpa$sym==0]
saved.BM.bpa$sym[saved.BM.bpa$sym==1]<-paste(saved.BM.bpa$tips[saved.BM.bpa$sym==1],"-sym",sep="")


```

```{r}
save.image(file = "SBR1 - Blouch Testing - BPAs - WS_122022_pt3.RData")
```







BPA Version

Adaptive Model
Half-life Accuracy Simulation Loops - varying tip nummber, hl, vy constant
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.adapt.bpa<-NULL
saved.adapt.parameters<-NULL

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
opt.slope<-0.25
#hl.list<-c(0.01,0.05,0.1,0.25,0.5,0.75,1.0,2.0) #For Main Plots
hl.list<-seq(from=0.001, to=1, by=0.05) #For BPA Plots
#hl.list<-0.1
#tips.list<-c(32,64,126)


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

vY0 <- 2
vX0 <- 4

##################################
#vy<-0.0001

#saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
##sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
#saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])


##################################
vy<-0.001


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])


#######################
vy<-0.01


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

#######################
vy<-0.1


sim<-stan.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.adapt.parameters<-rbind(saved.adapt.parameters,sim[[1]])
saved.adapt.bpa<-rbind(saved.adapt.bpa,sim[[2]])

```


```{r}
save.image(file = "SBR1 - Blouch - BPA Plots - Blouch Adaptive - WS_122022.RData")
```



Slouch Version
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
 
saved.slouch.adapt.bpa<-NULL
saved.slouch.adapt.parameters<-NULL
saved.slouch.trees<-list()
saved.slouch.data<-list()
##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-seq(from=0.001, to=1, by=0.05)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#tips.list<-c(32,64,128)
#tips.list<-c(32)
#hl.list<-c(0.01,0.1) #Test


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

##################################
#vy<-0.0001

#sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
#saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
#saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
#saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
#saved.slouch.data<-list(saved.slouch.data,sim[[4]])

##################################
vy<-0.001


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])


#######################
vy<-0.01


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

#######################
vy<-0.1


sim<-slouch.adapt.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,opt.slope,hl.list,vy,vY0,vX0)
saved.slouch.adapt.parameters<-rbind(saved.slouch.adapt.parameters,sim[[1]])
saved.slouch.adapt.bpa<-rbind(saved.slouch.adapt.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

```


```{r}
save.image(file = "SBR1 - Slouch - BPA Plots - Adaptive - WS_122022.RData")

```


Make Plots using SBR1 - Blouch Testing - BPA Plots


Direct Effect Model
Half-life Accuracy Simulation Loops - varying tip nummber, hl, vy constant
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.direct.bpa<-NULL
saved.direct.parameters<-NULL
direct.slope <- 0.25
hl.list<-seq(from=0.001, to=1, by=0.05) #For BPA Plots
#hl.list<-c(0.01,0.05,0.1,0.25,0.5,0.75,1.0,2.0) #For Main Plots

##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-c(0.05,0.1,0.25,0.5,1.0)
#hl.list<-c(0.05,0.1,0.25,0.3,0.4,0.5,0.75,1.0,2.0)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#hl.list[1]<-0.0001
#tips.list<-c(32,64,126)

#hl.list<-c(0.01,0.1) #Test


vY0 <- 2
vX0 <- 4

##################################
#vy<-0.0001

#sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
#saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
#saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])


##################################
vy<-0.001


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])


#######################
vy<-0.01


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])

#######################
vy<-0.1


sim<-stan.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.direct.parameters<-rbind(saved.direct.parameters,sim[[1]])
saved.direct.bpa<-rbind(saved.direct.bpa,sim[[2]])

#saved.bpa<-saved.bpa[-1,] #Remove first row - really small (almost 0 half life)

```


```{r}
save.image(file = "SBR1 - Blouch - BPA Plots - Blouch Direct - WS_122022.RData")

```


Slouch Version
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Slouch Testing - SBR1/SBR1.slouch.OU.adap.inac.hl.R")

saved.slouch.direct.bpa<-NULL
saved.slouch.direct.parameters<-NULL
saved.slouch.trees<-list()
saved.slouch.data<-list()
##################################
#1% - Added in sigma2y from Hansen et al. 2008 - vy scaled by A
#A = log(2)/0.01 = 69.31472
#B = -A * slope = -69.31472 * 0.25 = -17.32868
#opt.slope<-0.25
#hl.list<-seq(from=0.001, to=1, by=0.05)
#hl.list<-seq(from=0.05, to=2, by=0.05)
#tips.list<-c(32,64,128)
#tips.list<-c(32)
#hl.list<-c(0.01,0.1) #Test


#Mean centered X and Y
#vY0 <- 0
#vX0 <- 0

##################################
#vy<-0.0001

#sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
#saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
#saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
#saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
#saved.slouch.data<-list(saved.slouch.data,sim[[4]])

##################################
vy<-0.001


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])


#######################
vy<-0.01


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

#######################
vy<-0.1


sim<-slouch.direct.OU.inac.hl(tips.list=NULL,cervid.trdata$phy,N,direct.slope,hl.list,vy,vY0,vX0)
saved.slouch.direct.parameters<-rbind(saved.slouch.direct.parameters,sim[[1]])
saved.slouch.direct.bpa<-rbind(saved.slouch.direct.bpa,sim[[2]])
saved.slouch.trees<-list(saved.slouch.trees,sim[[3]])
saved.slouch.data<-list(saved.slouch.data,sim[[4]])

```


```{r}
save.image(file = "SBR1 - Slouch - BPA Plots - Direct - WS_122022.RData")

```


#######################

Brownian motion Loops

Brownian Slope Accuracy Simulation Loops
```{r}
#source("/Users/markgrabowski/Documents/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
source("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro (1)/Academic/Research/Current Projects/Blouch project/R1/Blouch Testing - SBR1/Functions/SBR1.stan.OU.adapt.inac.hl.R")
saved.BM.bpa<-NULL
saved.BM.parameters<-NULL

##################################
brown.slope<-0.25
#sigma2y.list<-seq(from=0.05, to=1, by=0.05)
sigma2y.list<-c(0.05,0.1,0.25,0.3,0.4,0.5,0.75,1.0,2.0)

#tips.list<-c(32,64,126)

#Mean centered X
vX0 <- 4

##################################
sim<-stan.BM.inac.hl(tips.list=NULL,cervid.trdata$phy,N,brown.slope,vX0,sigma2y.list)
saved.BM.parameters<-rbind(saved.BM.parameters,sim[[1]])
saved.BM.bpa<-rbind(saved.BM.bpa,sim[[2]])

```

```{r}
save.image(file = "SBR1 - Blouch - BPA Plots - Blouch BM - WS_122022.RData")

```



