---
title: "Prior Exploration For Simulations"
output: html_notebook
editor_options: 
  chunk_output_type: console
---
```{r}
library(ggplot2)
library(ggsci)
library(ggpubr)
```


*******************

Plots!

Hl Plot prior vs. posterior - assume posterior has been extracted using extract(model) and stored in post
```{r}
hl.sims<-data.frame(rlnorm(n=1000,meanlog=log(0.25),sdlog=0.75))
#hl.sims<-data.frame(hl.sims[hl.sims<3])
names(hl.sims)<-"prior.hl.sims"


hl.post<-data.frame(post$hl)
names(hl.post)<-"post.hl.sims"


hl.plot<-ggplot()+
  geom_density(aes(prior.hl.sims,fill="prior.hl.sims"),alpha=0.2,data=hl.sims)+
  geom_density(aes(post.hl.sims,fill="post.hl.sims"),alpha=0.2,data=hl.post)+
  theme_bw()+
  #labs(title="Prior vs. Posterior Distribution ",x="Half-life", y = "Density")+
  labs(title="",x="Half-life", y = "Density")+

    #scale_fill_manual(labels=c("Posterior","Prior"))+
  geom_vline(xintercept=c(hl),linetype=2)+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))

hl.plot
```



```{r}
vy.sims<-rexp(n=1000,rate=5)
vy.sims<-data.frame(vy.sims)
names(vy.sims)<-"prior.vy.sims"


vy.post<-data.frame(post$vy)
names(vy.post)<-"post.vy.sims"


vy.plot<-ggplot()+
  geom_density(aes(prior.vy.sims,fill="prior.vy.sims"),alpha=0.2,data=vy.sims)+
  geom_density(aes(post.vy.sims,fill="post.vy.sims"),alpha=0.2,data=vy.post)+
  theme_bw()+
  #labs(title="Prior vs. Posterior Distribution ",x="vy", y = "Density")+
  labs(title="",x="vy", y = "Density")+
  geom_vline(xintercept=c(vy),linetype=2)+

  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))

vy.plot
```



Slope and intercept - simple one level no regimes model
Prior vs. Posterior Plot

```{r}
library(ggsci)
library(rethinking)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
alpha.sims<-rnorm(100,2,0.2)
beta.sims<-rnorm(n=100,0,0.25)

alpha.post<-data.frame(post$alpha)
names(alpha.post)<-"post.alpha"

beta.post<-data.frame(post$beta)
names(beta.post)<-"post.beta"

mu.link<-function(x.seq){alpha.post+x.seq*beta.post}
x.seq <- seq(from=min(X), to=max(X) , length.out=100)
mu <- sapply(x.seq , mu.link )
mu.mean <-lapply( mu , mean )
mu.mean<-data.frame(as.numeric(mu.mean))
names(mu.mean)<-"mu.mean"

mu.CI <- lapply( mu , PI , prob=0.89 )
mu.CI<-data.frame(t(data.frame(mu.CI)),x.seq)
names(mu.CI)<-c("min.5.5","max.94.5","x.seq")

#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=Y,X=X)
names(df)<-c("Y","X")

df2<-data.frame(x.seq,mu.mean)

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.plot<-ggplot()+  
  geom_point(data=df,aes(y=Y,x=X))+
  geom_abline(intercept=alpha.sims,slope=beta.sims,alpha=0.15)+
  geom_line(data=df2,aes(x=x.seq,y=mu.mean),linetype=1)+
  geom_ribbon(data=mu.CI,aes(x=x.seq,ymin=min.5.5,ymax=max.94.5),linetype=2,alpha=0.25)+
  theme_bw()+
  #ggtitle("Prior vs. Posterior for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.plot
```


Change figure number depending on model/parameter combination
```{r}
text.box<-paste("Fig. S12: Prior vs. posterior for A) Half-life, B) vy, and C) Predicted mean intercept and slope and 89% compatibility interval for the means with priors in light grey and posteior in dark grey colors. For this simulation parameter values were set to: hl=0.75, vy=0.1, alpha=2, beta=0.25; Priors: hl~lognormal(log(0.25),0.75); vy~exponential(5); alpha~normal(0,1); beta~normal(0,1). Dotted lines in A) and B) are true values of the parameter")
text.box <- ggparagraph(text.box, face = "plain", size = 11)

fig<-ggarrange(hl.plot, vy.plot, slope.plot, text.box, ncol=2,nrow=2, labels = c("A)","B)","C)"),common.legend = TRUE,legend="top")
ggsave("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro/Documents/Academic/Research/Current Projects/Blouch project/R1 blouch-testing branch/Documents/Validation Figures/blouch_validation_figS12.pdf", plot = fig, width=7, height=7 )


```


Multiple traits -  no slopes
```{r}
text.box<-paste("Fig. S14: Prior vs. posterior for A) Half-life, B) vy. For this simulation parameter values were set to: hl=0.1, vy=0.1, alpha=2, beta=(0.5,0.35,0.1); Priors: hl~lognormal(log(0.25),0.75); vy~exponential(5); alpha~normal(0,1); beta~normal(0,1). Dotted lines in A) and B) are true values of the parameter. Brownian motion matrix assumes no correlation between predictors.")
text.box <- ggparagraph(text.box, face = "plain", size = 11)

fig<-ggarrange(hl.plot, vy.plot, ncol=2,nrow=1, labels = c("A)","B)"),common.legend = TRUE,legend="top")
fig<-ggarrange(fig,text.box, ncol=1,nrow=2)+
    theme(plot.margin = margin(0,1,-7,1, "cm")) 
ggsave("/Users/markgrabowski/Library/CloudStorage/GoogleDrive-mark.walter.grabowski@gmail.com/Other computers/My MacBook Pro/Documents/Academic/Research/Current Projects/Blouch project/R1 blouch-testing branch/Documents/Validation Figures/blouch_validation_figS14.pdf", plot = fig, width=7, height=5 )

```


Multiple Regression
```{r}
library(ggsci)
library(rethinking)

alpha.sims<-rnorm(100,2,0.2)
beta.sims<-rnorm(n=100,0,0.25)

alpha.post<-data.frame(post$alpha)
names(alpha.post)<-"post.alpha"

beta.post.1<-data.frame(post$beta[,1])
names(beta.post.1)<-"post.beta.1"

beta.post.2<-data.frame(post$beta[,2])
names(beta.post.2)<-"post.beta.2"

mu.link.1<-function(x.seq){alpha.post+x.seq*beta.post.1}
mu.link.2<-function(x.seq){alpha.post+x.seq*beta.post.2}
x.seq <- seq(from=min(Xs), to=max(Xs) , length.out=100)
mu.1 <- sapply(x.seq , mu.link.1 )
mu.2 <- sapply(x.seq , mu.link.2 )
mu.mean.1 <-lapply( mu.1 , mean )
mu.mean.2 <-lapply( mu.2 , mean )
mu.mean.1<-data.frame(as.numeric(mu.mean.1))
mu.mean.2<-data.frame(as.numeric(mu.mean.2))
names(mu.mean.1)<-"mu.mean.1"
names(mu.mean.2)<-"mu.mean.2"

mu.CI.1 <- lapply( mu.1 , PI , prob=0.89 )
mu.CI.2 <- lapply( mu.2 , PI , prob=0.89 )
mu.CI.1<-data.frame(t(data.frame(mu.CI.1)),x.seq)
mu.CI.2<-data.frame(t(data.frame(mu.CI.2)),x.seq)

names(mu.CI.1)<-c("min.5.5","max.94.5","x.seq")
names(mu.CI.2)<-c("min.5.5","max.94.5","x.seq")

#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=dat$Y_obs,X=dat$X_obs)
df2<-data.frame(x.seq,mu.mean.1)
df3<-data.frame(x.seq,mu.mean.2)

#Combined plots
#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
#slope.plot.1<-ggplot()+  
#  geom_point(data=df,aes(y=Y,x=X.1))+
#  geom_point(data=df,aes(y=Y,x=X.2),alpha=0.25)+
#  geom_abline(intercept=alpha.sims,slope=beta.sims,alpha=0.15)+ #Prior
#  geom_line(data=df2,aes(x=x.seq,y=mu.mean.1),linetype=1)+
#  geom_ribbon(data=mu.CI.1,aes(x=x.seq,ymin=min.5.5,ymax=max.94.5),linetype=2,alpha=0.25)+
#  geom_line(data=df3,aes(x=x.seq,y=mu.mean.2),linetype=1,alpha=0.5)+
#  geom_ribbon(data=mu.CI.2,aes(x=x.seq,ymin=min.5.5,ymax=max.94.5),linetype=2,alpha=0.25)+

#  theme_bw()+
  #ggtitle("Prior vs. Posterior for Intercept and Slope")+
#  ylab("Trait 1") + xlab("Trait 2")+
#  scale_color_npg()

#slope.plot.1


#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.plot.1<-ggplot()+  
  geom_point(data=df,aes(y=Y,x=X.1))+
  geom_abline(intercept=alpha.sims,slope=beta.sims,alpha=0.15)+ #Prior
  geom_line(data=df2,aes(x=x.seq,y=mu.mean.1),linetype=1)+
  geom_ribbon(data=mu.CI.1,aes(x=x.seq,ymin=min.5.5,ymax=max.94.5),linetype=2,alpha=0.25)+
  theme_bw()+
  #ggtitle("Prior vs. Posterior for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.plot.1

slope.plot.2<-ggplot()+  
  geom_point(data=df,aes(y=Y,x=X.2))+
  geom_abline(intercept=alpha.sims,slope=beta.sims,alpha=0.15)+ #Prior
  geom_line(data=df3,aes(x=x.seq,y=mu.mean.2),linetype=1)+
  geom_ribbon(data=mu.CI.2,aes(x=x.seq,ymin=min.5.5,ymax=max.94.5),linetype=2,alpha=0.25)+
  theme_bw()+
  #ggtitle("Prior vs. Posterior for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 3")+
  scale_color_npg()

slope.plot.2

```












Half life for priors - asssume phylogeny is scaled to unit length
```{r}
hl.sims<-rlnorm(n=1000,meanlog=log(0.25),sdlog=0.75)
quantile(hl.sims,probs=c(0.1,0.25,0.5,0.75,0.9))

hl.sims[hl.sims<0.1]
hl.sims[hl.sims>1]

```

Prior Exploration
```{r}
hl.sims<-data.frame(rlnorm(n=1000,meanlog=log(0.25),sdlog=0.75))
#hl.sims<-data.frame(hl.sims[hl.sims<3])
names(hl.sims)<-"prior.hl.sims"

ggplot()+
  geom_density(aes(prior.hl.sims,fill="prior.hl.sims"),alpha=0.2,data=hl.sims)+
  theme_bw()+
  labs(title="Prior Distribution ",x="Half-life", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  geom_vline(xintercept=c(0.1,1),linetype=2)
  scale_fill_npg(name="",labels=c("Prior"))

  quantile(hl.sims$prior.hl.sims,probs=c(0.1,0.25,0.5,0.75,0.9))
  
  

```


Sigma2y - asssume phylogeny is scaled to unit length
```{r}
sigma2_y<-rexp(n=1000,rate=5)
plot(density(sigma2_y),main="Sigma2_y prior distribution")
quantile(sigma2_y,probs=c(0.1,0.5,0.75,0.9))

sigma2_y[sigma2_y<0.1]
sigma2_y[sigma2_y>1]
```



Plot prior vs. posterior
```{r}
sigma2y.sims<-rexp(n=1000,rate=5)
sigma2y.sims<-data.frame(sigma2y.sims)
names(sigma2y.sims)<-"prior.sigma2y.sims"


sigma2y.post<-data.frame(post$sigma2_y)
names(sigma2y.post)<-"post.sigma2y.sims"


ggplot()+
  geom_density(aes(prior.sigma2y.sims,fill="prior.sigma2y.sims"),alpha=0.2,data=sigma2y.sims)+
  geom_density(aes(post.sigma2y.sims,fill="post.sigma2y.sims"),alpha=0.2,data=sigma2y.post)+
  theme_bw()+
  labs(title="",x="Sigma2_y", y = "Density")+
  #labs(title="Prior vs. Posterior Distribution ",x="Sigma2_y", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))

```

vy
```{r}
vy.sims<-rexp(n=1000,rate=5)
vy.sims<-data.frame(vy.sims)
names(vy.sims)<-"prior.vy.sims"
quantile(vy.sims$prior.vy.sims,probs=c(0.1,0.5,0.75,0.9))


ggplot()+
  geom_density(aes(prior.vy.sims,fill="prior.vy.sims"),alpha=0.2,data=vy.sims)+
  theme_bw()+
  labs(title="Prior Distribution ",x="vy", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
    geom_vline(xintercept=c(vy),linetype=2)+

  scale_fill_npg(name="",labels=c("Prior"))

```




Optima from Regime-Only model
```{r}
optima.sims<-rnorm(n=1000,0,1)
optima.sims<-data.frame(optima.sims)
names(optima.sims)<-"prior.optima.sims"

optima.post<-data.frame(post$optima)
names(optima.post)<-c("post.optima.1","post.optima.2")


ggplot()+
  geom_density(aes(prior.optima.sims,fill="prior.optima.sims"),alpha=0.2,data=optima.sims)+
  geom_density(aes(post.optima.1,fill="post.optima.1"),alpha=0.2,data=optima.post)+
  geom_density(aes(post.optima.2,fill="post.optima.2"),alpha=0.2,data=optima.post)+

    theme_bw()+
  labs(title="Prior vs. Posterior Distribution ",x="Optima", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior Optima 1","Posterior Optima 2","Prior"))

```











Slope and intercept - simple one level no regimes model
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,4,0.2)
#slope_test<-rnorm(100,0,0.2)
slope_test<-rlnorm(n=100,meanlog=log(0.4),sdlog=1)

#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=Y,X=X)

names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```

slope and intercept - Two Xs
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,4,0.2)
slope_test<-rnorm(100,0,0.2)

df<-data.frame(Y=Y,X=Xs)

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X.1))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X.2))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 3")+
  scale_color_npg()

slope.prior.plot

```


Plot priors vs posterior
```{r}

```


Slope and intercept - simple one level regime model
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.1)
slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)


#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$random_cov)

names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```


Multilevel model - Normal Y data
```{r}
#beta_raw<-rnorm(100,0,1)
beta_bar<-rnorm(100,stan_sim_data$ols_intercept,0.05)
sd_beta<-rexp(100,7)
beta<-rnorm(100,beta_bar,sd_beta)
slope_test<-rnorm(100,stan_sim_data$ols_slope,0.05)

df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=beta,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```

Regime only model
Plotting intercepts
