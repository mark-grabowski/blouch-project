---
title: "Prior Exploration For Simulations"
output: html_notebook
editor_options: 
  chunk_output_type: console
---
```{r}
library(ggplot2)
library(ggsci)
```


Half life for priors - asssume phylogeny is scaled to unit length
```{r}
hl.sims<-rlnorm(n=1000,meanlog=log(0.5),sdlog=1)
#hl.sims<-rhnorm(n=1000,sigma=0.75)
plot(density(hl.sims),main="Half-life prior distribution")
abline(v=c(0.1,1))
quantile(hl.sims,probs=c(0.1,0.25,0.5,0.75,0.9))

hl.sims[hl.sims<0.1]
hl.sims[hl.sims>1]

```

Plot prior vs. posterior - assume posterior has been extracted using extract(model) and stored in post
```{r}
hl.sims<-rlnorm(n=1000,meanlog=log(0.4),sdlog=1)
hl.sims<-data.frame(hl.sims)
names(hl.sims)<-"prior.hl.sims"


hl.post<-data.frame(post$hl)
names(hl.post)<-"post.hl.sims"


ggplot()+
  geom_density(aes(prior.hl.sims,fill="prior.hl.sims"),alpha=0.2,data=hl.sims)+
  geom_density(aes(post.hl.sims,fill="post.hl.sims"),alpha=0.2,data=hl.post)+
  theme_bw()+
  geom_vline(xintercept=hl)+
  labs(title="Prior vs. Posterior Distribution ",x="Half-life", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))


```



Vy - asssume phylogeny is scaled to unit length
```{r}
vy<-rexp(n=1000,rate=5)
plot(density(vy),main="vy prior distribution")
quantile(vy,probs=c(0.1,0.5,0.75,0.9))

vy[vy<0.01]
vy[vy>1]
```



Plot prior vs. posterior
```{r}
vy.sims<-rexp(n=1000,rate=5)
vy.sims<-data.frame(vy.sims)
names(vy.sims)<-"prior.vy.sims"


vy.post<-data.frame(post$vy)
names(vy.post)<-"post.vy.sims"


ggplot()+
  geom_density(aes(prior.vy.sims,fill="prior.vy.sims"),alpha=0.2,data=vy.sims)+
  geom_density(aes(post.vy.sims,fill="post.vy.sims"),alpha=0.2,data=vy.post)+
  theme_bw()+
  labs(title="Prior vs. Posterior Distribution ",x="Vy", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))

```



Sigma2y - asssume phylogeny is scaled to unit length
```{r}
sigma2_y<-rexp(n=1000,rate=5)
plot(density(sigma2_y),main="Sigma2_y prior distribution")
quantile(sigma2_y,probs=c(0.1,0.5,0.75,0.9))

sigma2_y[sigma2_y<0.1]
sigma2_y[sigma2_y>1]
```



Plot prior vs. posterior
```{r}
sigma2y.sims<-rexp(n=1000,rate=5)
sigma2y.sims<-data.frame(sigma2y.sims)
names(sigma2y.sims)<-"prior.sigma2y.sims"


sigma2y.post<-data.frame(post$sigma2_y)
names(sigma2y.post)<-"post.sigma2y.sims"


ggplot()+
  geom_density(aes(prior.sigma2y.sims,fill="prior.sigma2y.sims"),alpha=0.2,data=sigma2y.sims)+
  geom_density(aes(post.sigma2y.sims,fill="post.sigma2y.sims"),alpha=0.2,data=sigma2y.post)+
  theme_bw()+
  labs(title="Prior vs. Posterior Distribution ",x="Sigma2_y", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior","Prior"))

```


Optima from Regime-Only model
```{r}
optima.sims<-rnorm(n=1000,0,1)
optima.sims<-data.frame(optima.sims)
names(optima.sims)<-"prior.optima.sims"

optima.post<-data.frame(post$optima)
names(optima.post)<-c("post.optima.1","post.optima.2")


ggplot()+
  geom_density(aes(prior.optima.sims,fill="prior.optima.sims"),alpha=0.2,data=optima.sims)+
  geom_density(aes(post.optima.1,fill="post.optima.1"),alpha=0.2,data=optima.post)+
  geom_density(aes(post.optima.2,fill="post.optima.2"),alpha=0.2,data=optima.post)+

    theme_bw()+
  labs(title="Prior vs. Posterior Distribution ",x="Optima", y = "Density")+
  #scale_fill_manual(labels=c("Posterior","Prior"))+
  scale_fill_npg(name="",labels=c("Posterior Optima 1","Posterior Optima 2","Prior"))

```







Slope and intercept - simple one level no regimes model
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,4,0.2)
#slope_test<-rnorm(100,0,0.2)
slope_test<-rlnorm(n=100,meanlog=log(0.4),sdlog=1)

#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=Y,X=X)

names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```

slope and intercept - Two Xs
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,4,0.2)
slope_test<-rnorm(100,0,0.2)

df<-data.frame(Y=Y,X=Xs)

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X.1))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X.2))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 3")+
  scale_color_npg()

slope.prior.plot

```


Plot priors vs posterior
```{r}

```


Slope and intercept - simple one level regime model
```{r}
library(ggsci)
#Direct Model
#intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.2)
#slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)

#Adaptive Model
intercept_test<-rnorm(100,stan_sim_data$ols_intercept,0.1)
slope_test<-rnorm(100,stan_sim_data$ols_slope,0.1)


#df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$random_cov)

names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```


Multilevel model - Normal Y data
```{r}
#beta_raw<-rnorm(100,0,1)
beta_bar<-rnorm(100,stan_sim_data$ols_intercept,0.05)
sd_beta<-rexp(100,7)
beta<-rnorm(100,beta_bar,sd_beta)
slope_test<-rnorm(100,stan_sim_data$ols_slope,0.05)

df<-data.frame(Y=stan_sim_data$Y,X=stan_sim_data$direct_cov)
names(df)<-c("Y","X")

#slope.prior.plot<-ggplot(data=reg.trdata$dat,aes(y=Sim1,x=X))+
slope.prior.plot<-ggplot(data=df,aes(y=Y,x=X))+  
  geom_point()+
  geom_abline(intercept=beta,slope=slope_test,alpha=0.25)+
  theme_bw()+
  ggtitle("Priors for Intercept and Slope")+
  ylab("Trait 1") + xlab("Trait 2")+
  scale_color_npg()

slope.prior.plot
```

Regime only model
Plotting intercepts
