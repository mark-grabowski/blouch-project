---
title: "Simulate Multi-OU with Predictor"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(ape)
library(geiger)

# Create a random phylogenetic tree
set.seed(123)
tree <- rtree(10)

# Define the parameters for the OU process
alpha1 <- 0.5
alpha2 <- 1.0
sigma1 <- 0.1
sigma2 <- 0.2

# Define the continuous predictor
predictor <- runif(10, min = 0, max = 1)

# Function to simulate the OU process with a predictor
sim_OU_predictor <- function(t, alpha, sigma, predictor) {
  x <- numeric(length(t))
  x[1] <- rnorm(1, 0, sigma / sqrt(2 * alpha))
  for (i in 2:length(t)) {
    x[i] <- x[i-1] + alpha * (predictor[i] - x[i-1]) * (t[i] - t[i-1]) + 
      sigma * rnorm(1)
  }
  return(x)
}

# Function to simulate the OU process on a tree with a predictor
sim_OU_tree_predictor <- function(tree, alpha, sigma, predictor) {
  tip_states <- lapply(tree$tip.label, function(x) {
    t <- c(0, cumsum(diff(tree$edge.length[tree$edge[,1] == x])))
    sim_OU_predictor(t, alpha, sigma, predictor)
  })
  return(tip_states)
}

# Simulate the OU process on the tree with different regimes and predictor
tip_states1 <- sim_OU_tree_predictor(c, alpha1, sigma1, predictor)
tip_states2 <- sim_OU_tree_predictor(tree, alpha2, sigma2, predictor)

# Combine the two sets of tip states
tip_states <- c(tip_states1, tip_states2)

# Plot the simulated data on the tree
plot_tree_continuous_traits(tree, tip_states, 
  xlim = c(-2, 2), ylim = c(-2, 2))

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

