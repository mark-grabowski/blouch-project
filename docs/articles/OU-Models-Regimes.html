<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="blouch">
<title>OU-Models-Regimes • blouch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OU-Models-Regimes">
<meta property="og:description" content="blouch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"mark-grabowski",utcoffset:"0"}))};sessionStorage.setItem("_swa","1");</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">blouch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Getting Started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/OU-Models.html">OU Models</a>
    <a class="dropdown-item" href="../articles/OU-Models-Prediction.html">OU Models with Prediction</a>
    <a class="dropdown-item" href="../articles/OU-Models-Regimes.html">OU Models with Regimes</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/mark-grabowski/blouch">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mark-grabowski.github.io/blouch/">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>OU-Models-Regimes</h1>
                        <h4 data-toc-skip class="author">MG</h4>
            
            <h4 data-toc-skip class="date">09/12/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mark-grabowski/blouch/blob/HEAD/vignettes/OU-Models-Regimes.Rmd"><code>vignettes/OU-Models-Regimes.Rmd</code></a></small>
      <div class="d-none name"><code>OU-Models-Regimes.Rmd</code></div>
    </div>

    
    
<div class="section level1">
<h1 id="ou-models">OU Models<a class="anchor" aria-label="anchor" href="#ou-models"></a>
</h1>
<p>This vignette walks you through the basic streps of running an analysis in Blouch.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Here we load the R packages used to setup the data for blouch, make figures post-analysis, etc. This includes Rstan, the the R interface to Stan. If you have not used Rstan before, it needs to be set up as shown here: <a href="https://mc-stan.org/users/interfaces/rstan" class="external-link uri">https://mc-stan.org/users/interfaces/rstan</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required package: usethis</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#devtools::install_github("Mark-Grabowski/blouch")</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mark-grabowski/blouch">blouch</a></span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">blouch</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load necessary packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/kopperud/slouch" class="external-link">slouch</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required package: StanHeaders</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## rstan version 2.26.4 (Stan version 2.26.1)</span></code></pre>
<pre><code><span class="co">## For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="co">## options(mc.cores = parallel::detectCores()).</span>
<span class="co">## To avoid recompilation of unchanged Stan programs, we recommend calling</span>
<span class="co">## rstan_options(auto_write = TRUE)</span>
<span class="co">## For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span>
<span class="co">## change `threads_per_chain` option:</span>
<span class="co">## rstan_options(threads_per_chain = 1)</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/uyedaj/treeplyr" class="external-link">treeplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required package: dplyr</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Attaching package: 'dplyr'</span></code></pre>
<pre><code><span class="co">## The following objects are masked from 'package:stats':</span>
<span class="co">## </span>
<span class="co">##     filter, lag</span></code></pre>
<pre><code><span class="co">## The following objects are masked from 'package:base':</span>
<span class="co">## </span>
<span class="co">##     intersect, setdiff, setequal, union</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Attaching package: 'treeplyr'</span></code></pre>
<pre><code><span class="co">## The following object is masked from 'package:stats':</span>
<span class="co">## </span>
<span class="co">##     reorder</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quentingronau/bridgesampling" class="external-link">bridgesampling</a></span><span class="op">)</span>

<span class="co">#For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="co">#options(mc.cores = parallel::detectCores())</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html" class="external-link">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>For the purposes of illustrating the software, we will use a dataset of ruminant brain and body sizes bundled with the Slouch package (Kopperud et al. 2020) and a corresponding phylogenetic tree (Toljagić et al. 2017). First, we will organize the brain and body data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load the phylogenetic tree with annotation data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">artiodactyla</span><span class="op">)</span>
<span class="va">phy</span> <span class="op">&lt;-</span> <span class="va">artiodactyla</span>

<span class="co">## Load the neocortex dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">neocortex</span><span class="op">)</span>

<span class="co">## Plot the tree</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ladderize.html" class="external-link">ladderize</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/load%20data-1.png" width="700"></p>
<p>Stealing some code from the Slouch tutorial, regimes are shown painted on the phylogeny as below</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Inspect the internal node regimes</span>
<span class="co">## These have order n+1, n+2, n+3 ...</span>
<span class="va">internal_regimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">node.label</span><span class="op">)</span>

<span class="co">## Concatenate tip and internal regimes. These will have order 1,2,3 ...</span>
<span class="va">regimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">neocortex</span><span class="op">$</span><span class="va">diet</span>, <span class="va">internal_regimes</span><span class="op">)</span>

<span class="co">## Pick out the regimes of the edges, in the order of phy$edge</span>
<span class="va">edge_regimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">regimes</span><span class="op">[</span><span class="va">phy</span><span class="op">$</span><span class="va">edge</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phy</span>, 
     edge.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Black"</span>, <span class="st">"Orange"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">[</span><span class="va">edge_regimes</span><span class="op">]</span>, 
     edge.width <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Plot%20Regimes-1.png" width="700"></p>
<p>Next we will use the treeplyr function make.treedata to combine the data and tree based on the “species” column, which has the taxa names. See <a href="https://github.com/uyedaj/treeplyr" class="external-link uri">https://github.com/uyedaj/treeplyr</a> for more on this package.Then we will filter the data so only individuals with both brain and body size, as well as the variance in brain and body size are included. Variance in these traits is considered measurement error, estimation error in species averages. Finally we mean scale the X data (here body mass) so that the average across species is 0.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ruminant.trdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/treeplyr/man/make.treedata.html" class="external-link">make.treedata</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">neocortex</span>,name_column<span class="op">=</span><span class="st">"species"</span><span class="op">)</span>

<span class="va">ruminant.trdata</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ruminant.trdata</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">brain_mass_g_log_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">body_mass_g_log_mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ruminant.trdata</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ruminant.trdata</span>,<span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">brain_se_squared</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">body_se_squared</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ruminant.trdata #Full dataset</span>

<span class="co">#Mean Scale</span>
<span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">bodycentered</span><span class="op">&lt;-</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g_log_mean</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g_log_mean</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#lm(ruminant.trdata$dat$brain_mass_g_log_mean~ruminant.trdata$dat$bodycentered+ruminant.trdata$dat$diet)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rescale-tree">Rescale Tree<a class="anchor" aria-label="anchor" href="#rescale-tree"></a>
</h2>
<p>Next, we rescale Tree to Height = 1</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">l.tree</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/branching.times.html" class="external-link">branching.times</a></span><span class="op">(</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span>
<span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">&lt;-</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">/</span><span class="va">l.tree</span> <span class="co">## rescale tree to height 1</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/branching.times.html" class="external-link">branching.times</a></span><span class="op">(</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1</span></code></pre>
</div>
<div class="section level2">
<h2 id="running-blouch-data-setup-function">Running Blouch Data Setup Function<a class="anchor" aria-label="anchor" href="#running-blouch-data-setup-function"></a>
</h2>
<p>Here we are finally setting up our dataset to run in Blouch, using the blouchOURegimes.setup.v1() function. This function takes out data formatted by treeplyr, and the names of our traits of interest in the order shown. Note that the categorical data should come first in the list of traits. The list produced by this function has data formatted to run both the direct effect (constraint) models and adaptive models. See Grabowski et al. (2016) for more on both of these models. Here the first trait is adapting towards the second.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#source("/Volumes/GoogleDrive/My Drive/Shared with Macbook/Current Projects/Blouch project/Stan Functions/blouch v1/Blouch Setup Files/blouchOUReg.setup.v1.R")</span>

<span class="co">#names.traits&lt;-c("diet","brain_mass_g_log_mean","bodycentered","NA","NA") #With ME</span>
<span class="va">names.traits</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diet"</span>,<span class="st">"brain_mass_g_log_mean"</span>,<span class="st">"bodycentered"</span>,<span class="st">"brain_se_squared"</span>,<span class="st">"body_se_squared"</span><span class="op">)</span> <span class="co">#With ME</span>

<span class="co">#Data must be logged before entry into blouch.setup</span>
<span class="co">#names.traits = c(response, predictor, me.response, me.predictor) - classical = 0 for inverse regression</span>
<span class="va">stan_data</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/blouchOUReg.setup.v1.html">blouchOUReg.setup.v1</a></span><span class="op">(</span><span class="va">ruminant.trdata</span>,<span class="va">names.traits</span><span class="op">)</span>

<span class="va">stan_constraint_data</span><span class="op">&lt;-</span><span class="va">stan_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">stan_adaptive_data</span><span class="op">&lt;-</span><span class="va">stan_data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="explore-priors-slope-and-intercept">Explore Priors: Slope and intercept<a class="anchor" aria-label="anchor" href="#explore-priors-slope-and-intercept"></a>
</h2>
<p>Priors must be set manually in the Stan Blouch code (e.g. blouchOUReg_v1.stan), but we use the same priors for this analysis as in the OU-Models vignette. Go back and look at that vignette if you need to explore the effect of your priors - do not use the default values.</p>
</div>
<div class="section level2">
<h2 id="direct-effect-models">Direct Effect Models<a class="anchor" aria-label="anchor" href="#direct-effect-models"></a>
</h2>
<p>Now that we have formatted our data and supplied reasonable priors for the various distributions, we can now run Blouch.</p>
<p>Now lets do a simple analysis. Blouch implements the model of constrained evolution (Hansen &amp; Bartoszek, 2012) known as the direct effect model, previously implemented in Grabowski et al. (2016), which can be used to test for allometric constraints.</p>
<p>Here we run this model using 2 chains and 4000 iterations per chain. This code follows standard Stan/Rstan code.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit.direct</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOUReg_v1</span>,data <span class="op">=</span> <span class="va">stan_constraint_data</span>,chains <span class="op">=</span> <span class="fl">2</span>,iter <span class="op">=</span> <span class="fl">100</span>,control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>,show_messages<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: The largest R-hat is NA, indicating chains have not mixed.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#r-hat</span></code></pre>
<pre><code><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></code></pre>
<pre><code><span class="co">## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#tail-ess</span></code></pre>
<p>Stan prints out a lot of info, so lets just look at the parameter estimates here and store the most important stuff for later.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Lets look at the parameter estimates</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.direct</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"r_squared"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Inference for Stan model: blouchOUReg_v1.</span>
<span class="co">## 2 chains, each with iter=100; warmup=50; thin=1; </span>
<span class="co">## post-warmup draws per chain=50, total post-warmup draws=100.</span>
<span class="co">## </span>
<span class="co">##           mean se_mean   sd 2.5%  25%  50%  75% 97.5% n_eff Rhat</span>
<span class="co">## a         4.81    1.60 4.53 0.38 1.75 3.88 5.44 18.61     8 1.29</span>
<span class="co">## hl        0.36    0.09 0.45 0.04 0.13 0.18 0.40  1.81    22 1.10</span>
<span class="co">## beta[1]   5.17    0.02 0.14 4.99 5.08 5.14 5.21  5.52    45 1.02</span>
<span class="co">## beta[2]   5.17    0.02 0.14 4.98 5.07 5.16 5.24  5.47    64 1.01</span>
<span class="co">## beta[3]   5.00    0.00 0.04 4.91 4.98 5.00 5.03  5.08   126 0.99</span>
<span class="co">## beta[4]   0.57    0.00 0.03 0.53 0.55 0.57 0.59  0.62    88 0.99</span>
<span class="co">## vy        0.02    0.00 0.01 0.01 0.01 0.02 0.02  0.03    32 1.02</span>
<span class="co">## r_squared 0.96    0.00 0.00 0.95 0.96 0.96 0.97  0.97    27 1.13</span>
<span class="co">## sigma2_y  0.14    0.04 0.12 0.02 0.06 0.10 0.16  0.44     9 1.29</span>
<span class="co">## </span>
<span class="co">## Samples were drawn using NUTS(diag_e) at Sat Dec 11 20:45:38 2021.</span>
<span class="co">## For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">## and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">## convergence, Rhat=1).</span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For downstream analysis and plots</span>
<span class="va">ext.fit.direct</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.direct</span><span class="op">)</span></code></pre></div>
<p>Blouch follows the same format of parameter estimate presentation as Slouch - see Hansen et al. (2008), Grabowski et al. (2016), and Kopperud et al. (2020) for more explanation.</p>
</div>
<div class="section level2">
<h2 id="trace-and-density-plots-for-estimated-parameters">Trace and Density Plots for estimated parameters<a class="anchor" aria-label="anchor" href="#trace-and-density-plots-for-estimated-parameters"></a>
</h2>
<p>We can look at how our procedures using the standard trace and density plots from Rstan</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.direct</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Direct%20Trace%20and%20Density%20Plots-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot.html" class="external-link">stan_dens</a></span><span class="op">(</span><span class="va">fit.direct</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Direct%20Trace%20and%20Density%20Plots-2.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#3X8</span></code></pre></div>
<p>These look good.</p>
</div>
<div class="section level2">
<h2 id="adaptive-model">Adaptive Model<a class="anchor" aria-label="anchor" href="#adaptive-model"></a>
</h2>
<p>Blouch also implements the model of adaptive evolution introduced by Hansen et al. (2008). Here the response variable evolves according to an Ornstein-Uhlenbeck process towards an optimal state that is modeled as a function of the predictor variable.</p>
<p>Here the code is mostly the same, but the data type sent to Stan is a different format from the stan_constraint_data above.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit.adaptive</span><span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span><span class="va">stanmodels</span><span class="op">$</span><span class="va">blouchOUReg_v1</span>,data <span class="op">=</span> <span class="va">stan_adaptive_data</span>,chains <span class="op">=</span> <span class="fl">2</span>,iter <span class="op">=</span> <span class="fl">100</span>,control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>,show_messages<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: The largest R-hat is NA, indicating chains have not mixed.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#r-hat</span></code></pre>
<pre><code><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></code></pre>
<pre><code><span class="co">## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="co">## Running the chains for more iterations may help. See</span>
<span class="co">## https://mc-stan.org/misc/warnings.html#tail-ess</span></code></pre>
<p>Stan prints out a lot of info, so lets just look at the parameter estimates here and store the most important stuff for later.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Lets look at the parameter estimates</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.adaptive</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"r_squared"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Inference for Stan model: blouchOUReg_v1.</span>
<span class="co">## 2 chains, each with iter=100; warmup=50; thin=1; </span>
<span class="co">## post-warmup draws per chain=50, total post-warmup draws=100.</span>
<span class="co">## </span>
<span class="co">##            mean se_mean    sd  2.5%   25%   50%   75%  97.5% n_eff Rhat</span>
<span class="co">## a         50.70    8.13 29.05 15.75 31.31 44.03 62.06 116.09    13 1.07</span>
<span class="co">## hl         0.02    0.00  0.01  0.01  0.01  0.02  0.02   0.04    11 1.08</span>
<span class="co">## beta[1]    5.13    0.01  0.05  5.04  5.10  5.12  5.17   5.22    96 1.01</span>
<span class="co">## beta[2]    5.09    0.01  0.06  4.99  5.05  5.09  5.13   5.20    43 1.01</span>
<span class="co">## beta[3]    5.00    0.00  0.04  4.93  4.98  5.01  5.03   5.07   128 0.99</span>
<span class="co">## beta[4]    0.59    0.00  0.02  0.54  0.58  0.59  0.60   0.65   200 0.98</span>
<span class="co">## vy         0.00    0.00  0.00  0.00  0.00  0.00  0.01   0.01     8 1.13</span>
<span class="co">## r_squared  0.97    0.00  0.00  0.96  0.96  0.97  0.97   0.97    52 1.06</span>
<span class="co">## sigma2_y   0.52    0.23  0.52  0.02  0.12  0.22  0.94   1.76     5 1.17</span>
<span class="co">## </span>
<span class="co">## Samples were drawn using NUTS(diag_e) at Sat Dec 11 20:52:52 2021.</span>
<span class="co">## For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">## and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">## convergence, Rhat=1).</span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For downstream analysis and plots</span>
<span class="va">ext.fit.adapive</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit.adaptive</span><span class="op">)</span></code></pre></div>
<p>Blouch follows the same format of parameter estimate presentation as Slouch - see Hansen et al. (2008), Grabowski et al. (2016), and Kopperud et al. (2020) for more explanation.</p>
</div>
<div class="section level2">
<h2 id="trace-and-density-plots-for-estimated-parameters-1">Trace and Density Plots for estimated parameters<a class="anchor" aria-label="anchor" href="#trace-and-density-plots-for-estimated-parameters-1"></a>
</h2>
<p>We can look at how our procedures using the standard trace and density plots from Rstan</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">fit.direct</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Adaptive%20Trace%20and%20Density%20Plots-1.png" width="700"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot.html" class="external-link">stan_dens</a></span><span class="op">(</span><span class="va">fit.direct</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"hl"</span>,<span class="st">"beta"</span>,<span class="st">"vy"</span>,<span class="st">"sigma2_y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Adaptive%20Trace%20and%20Density%20Plots-2.png" width="700"> These look good.</p>
</div>
<div class="section level2">
<h2 id="model-comparison-using-bayes-factors">Model Comparison using Bayes Factors<a class="anchor" aria-label="anchor" href="#model-comparison-using-bayes-factors"></a>
</h2>
<p>While using a Direct Effect or Adaptive model should be driven by the biological hypotheses being tested, it is simple to compare between different models using Bayes Factors. Here we use the bridgesampling R package (CITATION).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lml.fit.direct</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.direct</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">lml.fit.adaptive</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bridge_sampler.html" class="external-link">bridge_sampler</a></span><span class="op">(</span><span class="va">fit.adaptive</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">BF_att</span> <span class="op">&lt;-</span> <span class="fu">bridgesampling</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bridgesampling/man/bf.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">lml.fit.direct</span>, <span class="va">lml.fit.adaptive</span><span class="op">)</span>
<span class="va">BF_att</span></code></pre></div>
<pre><code><span class="co">## Estimated Bayes factor in favor of lml.fit.direct over lml.fit.adaptive: 57.14617</span></code></pre>
<p>We find that the data is 5.2 more likely under a model that assumes a direct effect model rather than af adaptive model.</p>
</div>
<div class="section level2">
<h2 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h2>
<p>Let’s make some plots of our results</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanx.me/ggsci/" class="external-link">ggsci</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="direct-effect-plot">Direct Effect Plot<a class="anchor" aria-label="anchor" href="#direct-effect-plot"></a>
</h2>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">brain_mass_g_log_mean</span>,x<span class="op">=</span><span class="va">bodycentered</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="co">#geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.direct</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span>,mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">diet</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2.0</span>,alpha<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Direct Effect Model"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Brain Mass (g)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Body Mass (g)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_color_npg</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Direct%20Effect%20Plot-1.png" width="700"> The diet data has three regimes, in the order: Levels: Br Gr MF. Our results above and plotted here suggest only the third regime is having an effect on relative brain mass.</p>
</div>
<div class="section level2">
<h2 id="adaptive-plot">Adaptive Plot<a class="anchor" aria-label="anchor" href="#adaptive-plot"></a>
</h2>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">brain_mass_g_log_mean</span>,x<span class="op">=</span><span class="va">bodycentered</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="co">#geom_abline(intercept=intercept_test,slope=slope_test,alpha=0.25)+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ext.fit.adapive</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ruminant.trdata</span><span class="op">$</span><span class="va">dat</span>,mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">diet</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2.0</span>,alpha<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Adaptive Model"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log Brain Mass (g)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"log Body Mass (g)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_color_npg</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="OU-Models-Regimes_files/figure-html/Adaptive%20Plot-1.png" width="700"> The diet data has three regimes, in the order: Levels: Br Gr MF. Our results above and plotted here suggest only the first regime might be having an effect on the adaptive relationship between brain mass and body mass.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Grabowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
